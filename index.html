<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>è‡ªèµ°æ£‹ï¼šæ ¼å­å°æˆ°èˆ‡æŠ€èƒ½ç³»çµ±</title>
    <style>
        body { display: flex; flex-direction: column; align-items: center; background: #1a1a1a; color: #eee; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { border: 4px solid #444; background: #2c3e50; cursor: crosshair; }
        .ui-panel { margin: 15px; padding: 10px; background: #333; border-radius: 8px; width: 600px; display: flex; justify-content: space-between; }
        .log { font-size: 14px; color: #f1c40f; }
    </style>
</head>
<body>

    <h2>è¯ç›Ÿæˆ°æ£‹æ¨¡æ“¬ (æ ¼å­ç‰ˆ)</h2>
    <div class="ui-panel">
        <div id="status">æˆ°é¬¥é€²è¡Œä¸­...</div>
        <div class="log" id="combatLog">ç­‰å¾…æŠ€èƒ½è§¸ç™¼...</div>
    </div>
    <canvas id="gameCanvas" width="640" height="480"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const logText = document.getElementById('combatLog');

// 1. æ ¼å­é…ç½® (ç°¡å–®çš„æ­£æ–¹å½¢ç¶²æ ¼)
const TILE_SIZE = 80;
const ROWS = 6;
const COLS = 8;

// 2. æ£‹å­é¡åˆ¥
class Champion {
    constructor(name, gridX, gridY, color, team) {
        this.name = name;
        this.gridX = gridX;
        this.gridY = gridY;
        this.color = color;
        this.team = team;
        
        // æ•¸å€¼è¨­å®š
        this.hp = 200;
        this.maxHp = 200;
        this.mp = 0;
        this.maxMp = 100;
        this.atk = 20;
        this.range = 1; // æ”»æ“Šè·é›¢(æ ¼æ•¸)
        this.isCasting = false;
        
        this.updatePixelPos();
    }

    // å°‡æ ¼å­åæ¨™è½‰ç‚ºç•«é¢ä¸Šåƒç´ åæ¨™
    updatePixelPos() {
        this.x = this.gridX * TILE_SIZE + TILE_SIZE / 2;
        this.y = this.gridY * TILE_SIZE + TILE_SIZE / 2;
    }

    draw() {
        // ç•«è¡€æ¢ (ç´…è‰²èƒŒæ™¯ï¼Œç¶ è‰²ç•¶å‰è¡€é‡)
        ctx.fillStyle = '#ff4d4d';
        ctx.fillRect(this.x - 30, this.y - 45, 60, 6);
        ctx.fillStyle = '#2ecc71';
        ctx.fillRect(this.x - 30, this.y - 45, (this.hp / this.maxHp) * 60, 6);

        // ç•«é­”åŠ›æ¢ (è—è‰²)
        ctx.fillStyle = '#3498db';
        ctx.fillRect(this.x - 30, this.y - 37, (this.mp / this.maxMp) * 60, 4);

        // ç•«æ£‹å­æœ¬é«”
        ctx.beginPath();
        ctx.arc(this.x, this.y, 25, 0, Math.PI * 2);
        ctx.fillStyle = this.isCasting ? '#f1c40f' : this.color; // æ–½æ³•æ™‚è®Šé‡‘è‰²
        ctx.shadowBlur = this.isCasting ? 20 : 0;
        ctx.shadowColor = "yellow";
        ctx.fill();
        ctx.closePath();
        ctx.shadowBlur = 0;

        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.fillText(this.name, this.x, this.y + 5);
    }

    // é‚è¼¯åˆ¤æ–·
    act(target) {
        if (!target || target.hp <= 0) return;

        // è¨ˆç®—æ ¼å­è·é›¢ (æ›¼å“ˆé “è·é›¢)
        const dist = Math.abs(this.gridX - target.gridX) + Math.abs(this.gridY - target.gridY);

        if (dist <= this.range) {
            // åœ¨ç¯„åœå…§ï¼šæ”»æ“Šä¸¦å¢åŠ é­”åŠ›
            this.attack(target);
        } else {
            // ä¸åœ¨ç¯„åœå…§ï¼šå‘ç›®æ¨™ç§»å‹•ä¸€æ ¼
            this.moveTowards(target);
        }
    }

    moveTowards(target) {
        if (this.gridX < target.gridX) this.gridX++;
        else if (this.gridX > target.gridX) this.gridX--;
        else if (this.gridY < target.gridY) this.gridY++;
        else if (this.gridY > target.gridY) this.gridY--;
        
        this.updatePixelPos();
    }

    attack(target) {
        // æ™®æ”»
        target.hp -= this.atk;
        this.mp += 20; // æ¯æ¬¡æ”»æ“Šå›è—
        
        // æª¢æŸ¥æ˜¯å¦æ»¿é­”æ”¾æŠ€èƒ½
        if (this.mp >= this.maxMp) {
            this.castSkill(target);
        }
    }

    castSkill(target) {
        this.isCasting = true;
        this.mp = 0;
        const skillDamage = this.atk * 3;
        target.hp -= skillDamage;
        logText.innerText = `ğŸ’¥ ${this.name} é‡‹æ”¾äº†å¤§æ‹›ï¼é€ æˆ ${skillDamage} å‚·å®³`;
        
        // 1ç§’å¾Œè§£é™¤æ–½æ³•ç‰¹æ•ˆ
        setTimeout(() => { this.isCasting = false; }, 500);
    }
}

// 3. åˆå§‹åŒ–
const player1 = new Champion("è“‹å€«", 1, 2, "#3498db", "Blue");
const player2 = new Champion("è«¾å”", 6, 2, "#e74c3c", "Red");

// 4. ç¹ªè£½èƒŒæ™¯æ ¼å­
function drawGrid() {
    ctx.strokeStyle = "#444";
    for (let i = 0; i <= COLS; i++) {
        ctx.moveTo(i * TILE_SIZE, 0);
        ctx.lineTo(i * TILE_SIZE, ROWS * TILE_SIZE);
    }
    for (let j = 0; j <= ROWS; j++) {
        ctx.moveTo(0, j * TILE_SIZE);
        ctx.lineTo(COLS * TILE_SIZE, j * TILE_SIZE);
    }
    ctx.stroke();
}

// 5. éŠæˆ²ä¸»å¾ªç’° (ç‚ºäº†æ ¼å­å°æˆ°æ„Ÿï¼Œæˆ‘å€‘é™ä½åµæ•¸æˆ–ä½¿ç”¨è¨ˆæ™‚å™¨)
let frameCount = 0;
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawGrid();

    player1.draw();
    player2.draw();

    // æ¯éš” 60 å¹€ (ç´„1ç§’) è¡Œå‹•ä¸€æ¬¡ï¼Œæ¨¡æ“¬å›åˆæ„Ÿ
    if (frameCount % 60 === 0 && player1.hp > 0 && player2.hp > 0) {
        player1.act(player2);
        player2.act(player1);
    }

    if (player1.hp <= 0 || player2.hp <= 0) {
        const winner = player1.hp > 0 ? player1.name : player2.name;
        document.getElementById('status').innerText = "æˆ°é¬¥çµæŸï¼è´å®¶æ˜¯ï¼š" + winner;
    }

    frameCount++;
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
